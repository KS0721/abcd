<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4A90A4">
    <title>올인원 AAC</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div id="app" class="app-container">
        
        <!-- ========== 헤더 ========== -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo">
                    <i data-lucide="message-circle"></i>
                    <span>올인원<strong>AAC</strong></span>
                </div>
            </div>
            <div class="header-right">
            </div>
        </header>

        <!-- ========== 메인 슬라이드 ========== -->
        <main class="slide-container">
            <div class="slide-wrapper" id="slideWrapper">
                
                <!-- ===== 탭 1: 말하기 ===== -->
                <section class="slide" id="slideSpeak">
                    <!-- 긴급 버튼 -->
                    <div class="emergency-bar">
                        <button class="emergency-btn" data-text="도와주세요!" data-icon="help-circle">
                            <i data-lucide="help-circle"></i>
                            <span>도움</span>
                        </button>
                        <button class="emergency-btn" data-text="아파요!" data-icon="heart-pulse">
                            <i data-lucide="heart-pulse"></i>
                            <span>아픔</span>
                        </button>
                        <button class="emergency-btn" data-text="화장실 가고 싶어요" data-icon="door-open">
                            <i data-lucide="door-open"></i>
                            <span>화장실</span>
                        </button>
                    </div>

                    <!-- 카테고리 탭 -->
                    <div class="category-tabs">
                        <button class="tab-btn active" data-category="action">
                            <i data-lucide="footprints"></i>
                            <span>행동</span>
                        </button>
                        <button class="tab-btn" data-category="feeling">
                            <i data-lucide="smile"></i>
                            <span>감정</span>
                        </button>
                        <button class="tab-btn" data-category="need">
                            <i data-lucide="hand"></i>
                            <span>요청</span>
                        </button>
                        <button class="tab-btn" data-category="pain">
                            <i data-lucide="activity"></i>
                            <span>통증</span>
                        </button>
                        <button class="tab-btn" data-category="place">
                            <i data-lucide="map-pin"></i>
                            <span>장소</span>
                        </button>
                        <button class="tab-btn" data-category="person">
                            <i data-lucide="users"></i>
                            <span>사람</span>
                        </button>
                        <button class="tab-btn" data-category="food">
                            <i data-lucide="utensils"></i>
                            <span>음식</span>
                        </button>
                        <button class="tab-btn" data-category="time">
                            <i data-lucide="clock"></i>
                            <span>시간</span>
                        </button>
                    </div>

                    <!-- 카드 그리드 -->
                    <div class="cards-area">
                        <div id="cardsContainer" class="cards-container"></div>
                    </div>

                    <!-- 통증 스케일 -->
                    <div id="painScale" class="pain-scale hidden">
                        <div class="pain-title">통증 정도</div>
                        <div class="pain-buttons" id="painButtons"></div>
                        <div class="pain-labels">
                            <span>약함</span>
                            <span>보통</span>
                            <span>심함</span>
                        </div>
                    </div>

                    <!-- 추천 패널 -->
                    <div id="suggestionPanel" class="suggestion-panel hidden">
                        <div class="suggestion-header">
                            <i data-lucide="sparkles"></i>
                            <span id="suggestionWord">단어</span> 다음에...
                            <button id="closeSuggestionPanel" class="close-btn">
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                        <div id="suggestionCards" class="suggestion-cards"></div>
                    </div>
                </section>

                <!-- ===== 탭 2: 사용 기록 ===== -->
                <section class="slide" id="slideHistory">
                    <div class="slide-header">
                        <h2>사용 기록</h2>
                        <button id="clearHistoryBtn" class="text-btn danger">
                            <i data-lucide="trash-2"></i>
                            전체 삭제
                        </button>
                    </div>
                    <div id="historyContainer" class="history-container">
                        <p class="empty-message">아직 사용 기록이 없습니다</p>
                    </div>
                </section>

                <!-- ===== 탭 3: 검색 ===== -->
                <section class="slide" id="slideSearch">
                    <div class="search-box">
                        <i data-lucide="search"></i>
                        <input type="text" id="searchInput" placeholder="단어나 문장 검색...">
                    </div>
                    <div id="searchResults" class="search-results"></div>
                </section>

                <!-- ===== 탭 4: 설정 ===== -->
                <section class="slide" id="slideSettings">
                    <div class="settings-content">
                        <!-- 화면 설정 -->
                        <div class="settings-section">
                            <div class="settings-section-title">
                                <i data-lucide="monitor"></i>
                                <span>화면</span>
                            </div>
                            <div class="setting-item toggle">
                                <label>
                                    <i data-lucide="moon"></i>
                                    고대비 모드 (다크)
                                </label>
                                <label class="switch">
                                    <input type="checkbox" id="darkModeToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-item">
                                <label>글자 크기</label>
                                <select id="fontSize">
                                    <option value="small">작게</option>
                                    <option value="medium" selected>보통</option>
                                    <option value="large">크게</option>
                                </select>
                            </div>
                        </div>

                        <!-- 진동 설정 -->
                        <div class="settings-section">
                            <div class="settings-section-title">
                                <i data-lucide="vibrate"></i>
                                <span>피드백</span>
                            </div>
                            <div class="setting-item toggle">
                                <label>
                                    <i data-lucide="smartphone"></i>
                                    진동 피드백
                                </label>
                                <label class="switch">
                                    <input type="checkbox" id="vibrationToggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- 도움말 -->
                        <div class="settings-section">
                            <div class="settings-section-title">
                                <i data-lucide="help-circle"></i>
                                <span>사용법</span>
                            </div>
                            <div class="help-list">
                                <div class="help-item">
                                    <i data-lucide="hand"></i>
                                    <div>
                                        <strong>카드 선택</strong>
                                        <p>카드를 터치하면 메시지가 선택됩니다</p>
                                    </div>
                                </div>
                                <div class="help-item">
                                    <i data-lucide="sparkles"></i>
                                    <div>
                                        <strong>추천 기능</strong>
                                        <p>동사 선택 시 관련 단어를 추천해줍니다</p>
                                    </div>
                                </div>
                                <div class="help-item">
                                    <i data-lucide="clock"></i>
                                    <div>
                                        <strong>롱프레스</strong>
                                        <p>카드를 길게 누르면 시제/존댓말 변경</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 앱 정보 -->
                        <div class="app-info">
                            <div class="app-info-logo">
                                <i data-lucide="heart"></i>
                                <span>바이오헬스 원팀</span>
                            </div>
                            <p>버전 2.0.0</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- ========== 출력 바 ========== -->
        <div class="output-bar">
            <div id="outputText" class="output-text">
                <span class="placeholder">카드를 선택하세요</span>
            </div>
            <div class="output-actions">
                <button id="speakBtn" class="output-btn speak" disabled>
                    <i data-lucide="volume-2"></i>
                </button>
                <button id="showBtn" class="output-btn show" disabled>
                    <i data-lucide="maximize-2"></i>
                </button>
                <button id="clearBtn" class="output-btn clear" disabled>
                    <i data-lucide="x"></i>
                </button>
            </div>
        </div>

        <!-- ========== 하단 탭 바 ========== -->
        <nav class="tab-bar">
            <button class="tab-bar-btn active" data-slide="0">
                <i data-lucide="message-square"></i>
                <span>말하기</span>
            </button>
            <button class="tab-bar-btn" data-slide="1">
                <i data-lucide="history"></i>
                <span>기록</span>
            </button>
            <button class="tab-bar-btn" data-slide="2">
                <i data-lucide="search"></i>
                <span>검색</span>
            </button>
            <button class="tab-bar-btn" data-slide="3">
                <i data-lucide="settings"></i>
                <span>설정</span>
            </button>
        </nav>
    </div>

    <!-- ========== 청자 모드 모달 ========== -->
    <div id="listenerModal" class="modal-fullscreen hidden">
        <button id="closeListenerModal" class="modal-close-fullscreen">
            <i data-lucide="x"></i>
        </button>
        <div class="listener-content">
            <div id="listenerIcon" class="listener-icon">
                <i data-lucide="message-circle"></i>
            </div>
            <div id="listenerText" class="listener-text">메시지</div>
        </div>
    </div>

    <!-- ========== 카드 추가 모달 ========== -->
    <div id="addCardModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>새 카드 추가</h3>
                <button id="closeAddCardModal" class="modal-close-btn">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>카드 텍스트</label>
                    <input type="text" id="newCardText" placeholder="예: 사랑해요" maxlength="20">
                </div>
                <div class="form-group">
                    <label>아이콘 선택</label>
                    <div id="iconSelector" class="icon-grid"></div>
                </div>
                <div class="form-group">
                    <label>미리보기</label>
                    <div id="cardPreview" class="card-preview">
                        <div class="preview-icon">
                            <i data-lucide="message-circle"></i>
                        </div>
                        <span class="preview-text">새 카드</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelAddCard" class="secondary-btn">취소</button>
                <button id="confirmAddCard" class="primary-btn">
                    <i data-lucide="plus"></i>
                    추가
                </button>
            </div>
        </div>
    </div>

    <!-- ========== 확인 모달 ========== -->
    <div id="confirmModal" class="modal-overlay hidden">
        <div class="modal-content confirm-modal">
            <div class="confirm-icon">
                <i data-lucide="alert-circle"></i>
            </div>
            <p id="confirmMessage" class="confirm-message">정말 삭제할까요?</p>
            <div class="confirm-buttons">
                <button id="confirmCancel" class="secondary-btn">취소</button>
                <button id="confirmOk" class="danger-btn">삭제</button>
            </div>
        </div>
    </div>

    <!-- ========== 롱프레스 메뉴 ========== -->
    <div id="longpressMenu" class="longpress-menu hidden"></div>
    <div id="longpressOverlay" class="longpress-overlay hidden"></div>

    <!-- Lucide 아이콘 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- JS 파일들 (순서 중요!) -->
    <script src="js/data.js"></script>
    <script src="js/config.js"></script>
    <script src="js/state.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>

    <!-- 서비스 워커 해제 -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(regs => {
                regs.forEach(reg => reg.unregister());
            });
        }
    </script>
</body>
</html>